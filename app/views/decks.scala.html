@import views.Page
@import controllers.Forms.NewDeckData
@import b3.vertical.fieldConstructor
@(decks: Iterable[Query.DeckListRow], newDeck: Form[NewDeckData])(implicit request: UserRequest[_], messages: Messages)
@main("Decks management", Page.Decks) {
	<div class="page-header">
		<h2>Decks management</h2>
	</div>
	<div class="row">
		<div class="col-md-9">
			<table class="table">
				<thead>
					<tr>
						<th style="width: 30px;"></th>
						<th>Deck name</th>
						<th>Universe</th>
						<th class="text-right">Card count</th>
						<th class="text-right">Actions</th>
					</tr>
				</thead>
				<tbody>
					@for(deck <- decks) {
						<tr>
							<td style="color: #999;">#@deck.id</td>
							<td>
								<a href="/decks/view/@deck.id">@deck.name</a>
							</td>
							<td>
								@for(universe <- deck.universes) {
									<a href="/cards/@universe._1" class="label label-default">@universe._2</a>
								}
								@if(deck.universes.isEmpty) {
									-
								}
							</td>
							<td class="text-right">
								@if(deck.ncx_count + deck.cx_count > 0) {
									@deck.ncx_count + @deck.cx_count
								} else {
									0
								}
								<span style="color: #999;">/ 50</span>
							</td>
							<td class="text-right actions">
								<button class="btn btn-xs btn-default">Edit</button>
								<button class="btn btn-xs btn-danger" data-id="@deck.id" style="width: 50px; text-align: center;">Delete</button>
							</td>
						</tr>
					}
				</tbody>
			</table>
			@if(decks.isEmpty) {
				<div class="alert alert-info">
					<strong>Oh!</strong>
					It looks like you have not created any deck yet.
				</div>
			}
		</div>
		<div class="col-md-3">
			<div class="panel panel-info">
				<div class="panel-heading">
					<h3 class="panel-title">Create new deck</h3>
				</div>
				<div class="panel-body">
					@b3.form(routes.Decks.create) {
						@b3.text(newDeck("name"), 'placeholder -> "Deck name", 'class -> "input-sm")
						<input type="submit" class="btn btn-primary btn-sm" value="Create">
					}
				</div>
			</div>
		</div>
	</div>
	<form action="@routes.Decks.delete" method="POST" id="delete-form">
		<input type="hidden" name="id" value="" id="delete-id">
	</form>
	<script>
		$(".actions .btn-danger").click(function(ev) {
			var btn = ev.target;
			if (btn.sure) {
				clearTimeout(btn.sure);
				$("#delete-id").val(btn.dataset.id);
				$("#delete-form").submit();
			} else {
				btn.sure = setTimeout(function() {
					btn.innerText = "Delete";
					btn.sure = void 0;
				}, 2000);
				btn.innerText = "Sure?";
			}
		});
	</script>
}
